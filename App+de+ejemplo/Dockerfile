FROM node:20.5.0-alpine3.18
RUN addgroup react && adduser -S -G react react
# BEFORE THE BELOW COMMAND, ALL COMMANDS WERE EXECUTED AS ROOT USER, AFTER BELOW COMMAND THEY ARE EXECUTED AS react USER
# BUT COPY COMMAND ALWAYS RUNS AS root USER UNLESS THIS IS MODIFIED WITH --chown=
USER react
WORKDIR /app/
RUN mkdir datos
# PRIMERO SE COPIAN LOS "REQUIREMENTS", ESTO PORQUE SI SE USA EL COMANDO COPY Y HAY ARCHIVOS MODIFICADOS, QUE LO MAS PROBABLE ES QUE SÍ, 
# TODOS LOS COMANDOS DE ABAJO SE TIENEN QUE VOLVER A EJECUTAR, ENTONCES EL RUN VA A TARDAR SIEMPRE. PERO SI SE COPIA PRIMERO SOLO LOS
# "REQUIREMENTS" (QUE LO MAS PROBABLE ES QUE ESOS ARCHIVOS NO SEAN MODIFICADOS) POR LO TANTO EL RUN NO VOLVERÁ A CORRER Y YA POR ULTIMO
# SE COPIAN LOS DEMAS ARCHIVOS. HACIENDO PRUEBAS, SI NO SE AGREGA PRIMERO LO DE "COPY package*.json ." LA CONSTRUCCION DE LA IMAGEN
# TARDA 8.9 SEGUNDOS, YA AGREGANDO ESE COMANDO, TARDA SOLO 0.5 SEGUNDOS
COPY --chown=react package*.json .
# ADD http://www.miweb.com/archivos .   -----> ADD puede archivos provenientes de una url
# ADD archivo.zip .    -----> ADD puede añadir zips
RUN npm install
# RUN apt install php     -----> Tambien sirve para instalar softwares dentro del contenedor
COPY --chown=react . .
ENV API=https://apiv2.miweb.com
# EXPOSE FUNCIONA SOLO COMO DOCUMENTACION, NO AFECTA 
EXPOSE 5173
CMD ["npm", "run", "dev"]
# CMD npm run dev      -----> esta forma no es optima porque inicia una nueva shell


# LA DIFERENCIA ENTRE RUN Y CMD. RUN IS USED WHEN THE IMAGE IS BEING CREATED, ON THE OTHER HAND CMD IS USED WHEN CONTAINER IS BEING INITIATED